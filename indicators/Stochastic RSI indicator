{
  "type": "indicator",
  "name": "indicators:UltimateStochasticRSI",
  "data": {
    "options": {
      "priceScaleId": "left",
      "priceFormat": { "auto": true, "precision": 3 },
      "priceLineVisible": false,
      "lastValueVisible": true,
      "visible": true,
      "scaleMargins": { "top": 0.85, "bottom": 0.05 }
    },
    "script": "// === ULTIMATE STOCHASTIC RSI SYSTEM ===\n// Comprehensive StochRSI with advanced signals, divergence detection, and multi-timeframe analysis\n\n// === CORE PARAMETERS ===\nlengthRSI     = input.int(14, title='RSI Length', minval=2, maxval=100, group='Core Settings')\nlengthStoch   = input.int(14, title='Stochastic Length', minval=2, maxval=100, group='Core Settings')\nsmoothK       = input.int(3,  title='%K Smoothing', minval=1, maxval=20, group='Core Settings')\nsmoothD       = input.int(3,  title='%D Smoothing', minval=1, maxval=20, group='Core Settings')\nsmoothingType = input.string('SMA', title='Smoothing Type', options=['SMA', 'EMA', 'RMA', 'WMA'], group='Core Settings')\n\n// === THRESHOLD LEVELS ===\noverboughtLevel = input.float(80, title='Overbought Level', minval=70, maxval=95, step=1, group='Levels')\noversoldLevel  = input.float(20, title='Oversold Level', minval=5, maxval=30, step=1, group='Levels')\nmidlineLevel   = input.float(50, title='Midline Level', minval=40, maxval=60, step=1, group='Levels')\nextremeOB      = input.float(90, title='Extreme Overbought', minval=85, maxval=98, step=1, group='Levels')\nextremeOS      = input.float(10, title='Extreme Oversold', minval=2, maxval=15, step=1, group='Levels')\n\n// === VISUAL OPTIONS ===\nshowK          = input.bool(true, title='Show %K Line', group='Display')\nshowD          = input.bool(true, title='Show %D Line', group='Display')\nshowFill       = input.bool(false, title='Show Fill Between K and D', group='Display')\nshowZones      = input.bool(true, title='Show Overbought/Oversold Zones', group='Display')\nshowMidline    = input.bool(true, title='Show Midline', group='Display')\nshowExtremes   = input.bool(false, title='Show Extreme Levels', group='Display')\nshowTable      = input.bool(true, title='Show Info Table', group='Display')\ntablePosition  = input.string('Top Right', title='Table Position', options=['Top Right', 'Top Left', 'Bottom Right', 'Bottom Left'], group='Display')\n\n// === SIGNAL OPTIONS ===\nshowBasicSignals = input.bool(true, title='Show Basic K/D Cross Signals', group='Signals')\nshowAdvancedSignals = input.bool(true, title='Show Advanced Entry/Exit Signals', group='Signals')\nshowDivergence   = input.bool(false, title='Show Divergence Signals', group='Signals')\nshowMomentum     = input.bool(false, title='Show Momentum Change Signals', group='Signals')\nshowOverlay      = input.bool(true, title='Show Overlay Signals on Chart', group='Signals')\nuseZoneFilter    = input.bool(true, title='Filter Signals by Zones', group='Signals')\nminBarsForSignal = input.int(1, title='Min Bars Between Signals', minval=0, maxval=10, group='Signals')\n\n// === DIVERGENCE SETTINGS ===\ndivLookback      = input.int(5, title='Divergence Lookback', minval=3, maxval=20, group='Divergence')\ndivMinStrength   = input.float(0.3, title='Min Divergence Strength', minval=0.1, maxval=1.0, step=0.1, group='Divergence')\nshowRegularDiv   = input.bool(true, title='Show Regular Divergence', group='Divergence')\nshowHiddenDiv    = input.bool(false, title='Show Hidden Divergence', group='Divergence')\n\n// === ALERT OPTIONS ===\nalertBasicCross  = input.bool(false, title='K/D Crossover Alerts', group='Alerts')\nalertLevelBreaks = input.bool(false, title='Level Break Alerts', group='Alerts')\nalertDivergence  = input.bool(false, title='Divergence Alerts', group='Alerts')\nalertExtremes    = input.bool(false, title='Extreme Level Alerts', group='Alerts')\n\n// === MULTI-TIMEFRAME ===\nuseMTF           = input.bool(false, title='Enable Multi-Timeframe', group='Multi-Timeframe')\nmtfTimeframe     = input.timeframe('1H', title='Higher Timeframe', group='Multi-Timeframe')\nshowMTFSignals   = input.bool(false, title='Show MTF Signals', group='Multi-Timeframe')\n\n// === FUNCTIONS ===\n\n// Custom smoothing function\nf_smooth(src, len, type) =>\n    switch type\n        'EMA' => ta.ema(src, len)\n        'RMA' => ta.rma(src, len)\n        'WMA' => ta.wma(src, len)\n        => ta.sma(src, len)\n\n// Divergence detection function\nf_findDivergence(osc, price, lookback, isRegular) =>\n    var bool divFound = false\n    if bar_index >= lookback * 2\n        // Find pivot points\n        oscHigh = ta.pivothigh(osc, lookback, lookback)\n        oscLow = ta.pivotlow(osc, price, lookback, lookback)\n        priceHigh = ta.pivothigh(price, lookback, lookback)\n        priceLow = ta.pivotlow(price, lookback, lookback)\n        \n        // Regular bullish divergence\n        if isRegular and not na(oscLow) and not na(priceLow)\n            if oscLow > oscLow[lookback] and priceLow < priceLow[lookback]\n                divFound := true\n        \n        // Regular bearish divergence\n        if isRegular and not na(oscHigh) and not na(priceHigh)\n            if oscHigh < oscHigh[lookback] and priceHigh > priceHigh[lookback]\n                divFound := true\n    divFound\n\n// Signal filtering function\nf_filterSignal(signal, lastSignalBar, minBars) =>\n    signal and (na(lastSignalBar) or bar_index - lastSignalBar >= minBars)\n\n// === CORE CALCULATIONS ===\n\n// RSI calculation\nrsiValue = ta.rsi(close, lengthRSI)\n\n// Stochastic normalization with zero division protection\nlowestRSI = ta.lowest(rsiValue, lengthStoch)\nhighestRSI = ta.highest(rsiValue, lengthStoch)\nrsiRange = highestRSI - lowestRSI\nrawStochRSI = rsiRange > 0 ? (rsiValue - lowestRSI) / rsiRange * 100 : 50\n\n// Smoothed K and D\nK = f_smooth(rawStochRSI, smoothK, smoothingType)\nD = f_smooth(K, smoothD, smoothingType)\n\n// Multi-timeframe calculations\n[mtfK, mtfD] = useMTF ? request.security(syminfo.tickerid, mtfTimeframe, [K, D]) : [K, D]\n\n// === SIGNAL GENERATION ===\n\n// Basic crossover signals\nbullishCross = ta.crossover(K, D)\nbearishCross = ta.crossunder(K, D)\n\n// Zone-based filtering\ninOversoldZone = K <= oversoldLevel\ninOverboughtZone = K >= overboughtLevel\ninNeutralZone = K > oversoldLevel and K < overboughtLevel\n\n// Advanced entry signals\nbullishEntry = bullishCross and (useZoneFilter ? inOversoldZone : true) and D < overboughtLevel\nbearishEntry = bearishCross and (useZoneFilter ? inOverboughtZone : true) and D > oversoldLevel\n\n// Exit signals\nbullishExit = K >= overboughtLevel and ta.crossunder(K, overboughtLevel)\nbearishExit = K <= oversoldLevel and ta.crossover(K, oversoldLevel)\n\n// Extreme level signals\nextremeOverbought = ta.crossover(K, extremeOB)\nextremeOversold = ta.crossunder(K, extremeOS)\nextremeOBExit = ta.crossunder(K, extremeOB)\nextremeOSExit = ta.crossover(K, extremeOS)\n\n// Momentum signals\nmomentumBullish = K > D and K > K[1] and D > D[1] and K > midlineLevel\nmomentumBearish = K < D and K < K[1] and D < D[1] and K < midlineLevel\n\n// Divergence signals\nbullishRegularDiv = showDivergence and showRegularDiv ? f_findDivergence(K, low, divLookback, true) and K < oversoldLevel + 10 : false\nbearishRegularDiv = showDivergence and showRegularDiv ? f_findDivergence(K, high, divLookback, true) and K > overboughtLevel - 10 : false\n\n// Signal filtering for minimum bars between signals\nvar int lastBullSignal = na\nvar int lastBearSignal = na\n\nfilteredBullishEntry = f_filterSignal(bullishEntry, lastBullSignal, minBarsForSignal)\nfilteredBearishEntry = f_filterSignal(bearishEntry, lastBearSignal, minBarsForSignal)\n\nif filteredBullishEntry\n    lastBullSignal := bar_index\nif filteredBearishEntry\n    lastBearSignal := bar_index\n\n// === VISUAL PLOTS ===\n\n// Main oscillator lines\nplotK = showK ? plot(K, color=color.new(#2196F3, 0), linewidth=2, title='StochRSI %K') : na\nplotD = showD ? plot(D, color=color.new(#FF9800, 0), linewidth=2, title='StochRSI %D') : na\n\n// Fill between K and D\nfillColor = showFill ? (K > D ? color.new(color.green, 85) : color.new(color.red, 85)) : na\nfill(plotK, plotD, color=fillColor, title='K/D Fill')\n\n// Horizontal reference lines\nhline(overboughtLevel, color=color.new(#F44336, 0), linestyle=hline.style_dashed, linewidth=1, title='Overbought')\nhline(oversoldLevel, color=color.new(#4CAF50, 0), linestyle=hline.style_dashed, linewidth=1, title='Oversold')\nhline(showMidline ? midlineLevel : na, color=color.new(#9E9E9E, 0), linestyle=hline.style_dotted, linewidth=1, title='Midline')\nhline(showExtremes ? extremeOB : na, color=color.new(#8B0000, 0), linestyle=hline.style_solid, linewidth=1, title='Extreme OB')\nhline(showExtremes ? extremeOS : na, color=color.new(#006400, 0), linestyle=hline.style_solid, linewidth=1, title='Extreme OS')\n\n// Background zones\nbgcolor(showZones and K >= overboughtLevel ? color.new(color.red, 95) : na, title='Overbought Zone')\nbgcolor(showZones and K <= oversoldLevel ? color.new(color.green, 95) : na, title='Oversold Zone')\nbgcolor(showZones and showExtremes and K >= extremeOB ? color.new(color.red, 90) : na, title='Extreme OB Zone')\nbgcolor(showZones and showExtremes and K <= extremeOS ? color.new(color.green, 90) : na, title='Extreme OS Zone')\n\n// === SIGNAL SHAPES ON OSCILLATOR ===\n\n// Basic crossover signals\nplotshape(showBasicSignals and filteredBullishEntry, style=shape.triangleup, location=location.bottom, \n          color=color.new(color.lime, 0), size=size.small, title='Bullish Cross')\nplotshape(showBasicSignals and filteredBearishEntry, style=shape.triangledown, location=location.top, \n          color=color.new(color.red, 0), size=size.small, title='Bearish Cross')\n\n// Advanced signals\nplotshape(showAdvancedSignals and bullishExit, style=shape.xcross, location=location.top, \n          color=color.new(color.orange, 0), size=size.tiny, title='Bullish Exit')\nplotshape(showAdvancedSignals and bearishExit, style=shape.xcross, location=location.bottom, \n          color=color.new(color.orange, 0), size=size.tiny, title='Bearish Exit')\n\n// Extreme level signals\nplotshape(showAdvancedSignals and extremeOverbought, style=shape.diamond, location=location.top, \n          color=color.new(color.purple, 0), size=size.small, title='Extreme OB')\nplotshape(showAdvancedSignals and extremeOversold, style=shape.diamond, location=location.bottom, \n          color=color.new(color.purple, 0), size=size.small, title='Extreme OS')\n\n// Momentum signals\nplotshape(showMomentum and momentumBullish and not momentumBullish[1], style=shape.arrowup, location=location.bottom, \n          color=color.new(color.aqua, 0), size=size.tiny, title='Momentum Bull')\nplotshape(showMomentum and momentumBearish and not momentumBearish[1], style=shape.arrowdown, location=location.top, \n          color=color.new(color.fuchsia, 0), size=size.tiny, title='Momentum Bear')\n\n// Divergence signals\nplotshape(showDivergence and bullishRegularDiv, style=shape.square, location=location.bottom, \n          color=color.new(color.yellow, 0), size=size.small, title='Bullish Divergence')\nplotshape(showDivergence and bearishRegularDiv, style=shape.square, location=location.top, \n          color=color.new(color.yellow, 0), size=size.small, title='Bearish Divergence')\n\n// === OVERLAY SIGNALS ON PRICE CHART ===\n// These will appear as dots on the main price chart when overlay is enabled\n\nif showOverlay\n    // Request to plot on main chart\n    var line bullishLine = na\n    var line bearishLine = na\n    \n    // Plot dots on price chart for major signals\n    if filteredBullishEntry\n        label.new(bar_index, low * 0.998, 'ðŸ”µ', style=label.style_none, color=color.new(color.lime, 0), \n                  textcolor=color.lime, size=size.normal, tooltip='StochRSI Bullish Signal')\n    \n    if filteredBearishEntry\n        label.new(bar_index, high * 1.002, 'ðŸ”´', style=label.style_none, color=color.new(color.red, 0), \n                  textcolor=color.red, size=size.normal, tooltip='StochRSI Bearish Signal')\n\n// === INFORMATION TABLE ===\n\nif showTable and barstate.islast\n    // Determine table position\n    tablePos = switch tablePosition\n        'Top Left' => position.top_left\n        'Bottom Right' => position.bottom_right\n        'Bottom Left' => position.bottom_left\n        => position.top_right\n    \n    var table infoTable = table.new(tablePos, 2, 8, bgcolor=color.new(color.white, 80), \n                                    border_width=1, border_color=color.gray)\n    \n    // Current values\n    table.cell(infoTable, 0, 0, 'StochRSI K:', text_color=color.black, text_size=size.small, bgcolor=color.new(color.blue, 90))\n    table.cell(infoTable, 1, 0, str.tostring(K, '#.##'), text_color=color.blue, text_size=size.small)\n    \n    table.cell(infoTable, 0, 1, 'StochRSI D:', text_color=color.black, text_size=size.small, bgcolor=color.new(color.orange, 90))\n    table.cell(infoTable, 1, 1, str.tostring(D, '#.##'), text_color=color.orange, text_size=size.small)\n    \n    // Status\n    table.cell(infoTable, 0, 2, 'Zone:', text_color=color.black, text_size=size.small)\n    zoneText = K >= extremeOB ? 'Extreme OB' : K >= overboughtLevel ? 'Overbought' : \n               K <= extremeOS ? 'Extreme OS' : K <= oversoldLevel ? 'Oversold' : 'Neutral'\n    zoneColor = K >= extremeOB ? color.maroon : K >= overboughtLevel ? color.red : \n                K <= extremeOS ? color.navy : K <= oversoldLevel ? color.green : color.gray\n    table.cell(infoTable, 1, 2, zoneText, text_color=zoneColor, text_size=size.small)\n    \n    // Trend\n    table.cell(infoTable, 0, 3, 'Trend:', text_color=color.black, text_size=size.small)\n    trendText = K > D ? 'Bullish' : K < D ? 'Bearish' : 'Neutral'\n    trendColor = K > D ? color.green : K < D ? color.red : color.gray\n    table.cell(infoTable, 1, 3, trendText, text_color=trendColor, text_size=size.small)\n    \n    // Momentum\n    table.cell(infoTable, 0, 4, 'Momentum:', text_color=color.black, text_size=size.small)\n    momentumText = momentumBullish ? 'Strong Up' : momentumBearish ? 'Strong Down' : \n                   K > K[1] ? 'Up' : K < K[1] ? 'Down' : 'Flat'\n    momentumColor = momentumBullish ? color.lime : momentumBearish ? color.red : \n                    K > K[1] ? color.green : K < K[1] ? color.orange : color.gray\n    table.cell(infoTable, 1, 4, momentumText, text_color=momentumColor, text_size=size.small)\n    \n    // Signal strength\n    table.cell(infoTable, 0, 5, 'Signal Strength:', text_color=color.black, text_size=size.small)\n    signalStrength = math.abs(K - D)\n    strengthText = signalStrength > 20 ? 'Strong' : signalStrength > 10 ? 'Medium' : 'Weak'\n    strengthColor = signalStrength > 20 ? color.green : signalStrength > 10 ? color.yellow : color.red\n    table.cell(infoTable, 1, 5, strengthText, text_color=strengthColor, text_size=size.small)\n    \n    // MTF info if enabled\n    if useMTF\n        table.cell(infoTable, 0, 6, 'MTF Trend:', text_color=color.black, text_size=size.small)\n        mtfTrendText = mtfK > mtfD ? 'Bullish' : 'Bearish'\n        mtfTrendColor = mtfK > mtfD ? color.green : color.red\n        table.cell(infoTable, 1, 6, mtfTrendText, text_color=mtfTrendColor, text_size=size.small)\n\n// === COMPREHENSIVE ALERT SYSTEM ===\n\n// Basic crossover alerts\nalertcondition(alertBasicCross and filteredBullishEntry, title='StochRSI Bullish Cross', \n               message='StochRSI: Bullish crossover - K({{plot(\"StochRSI %K\")}}) crossed above D({{plot(\"StochRSI %D\")}})')\nalertcondition(alertBasicCross and filteredBearishEntry, title='StochRSI Bearish Cross', \n               message='StochRSI: Bearish crossover - K({{plot(\"StochRSI %K\")}}) crossed below D({{plot(\"StochRSI %D\")}})')\n\n// Level break alerts\nalertcondition(alertLevelBreaks and ta.crossover(K, overboughtLevel), title='StochRSI Overbought Entry', \n               message='StochRSI: Entered overbought territory - K: {{plot(\"StochRSI %K\")}}')\nalertcondition(alertLevelBreaks and ta.crossunder(K, oversoldLevel), title='StochRSI Oversold Entry', \n               message='StochRSI: Entered oversold territory - K: {{plot(\"StochRSI %K\")}}')\nalertcondition(alertLevelBreaks and bullishExit, title='StochRSI Overbought Exit', \n               message='StochRSI: Exited overbought territory - Consider taking profits')\nalertcondition(alertLevelBreaks and bearishExit, title='StochRSI Oversold Exit', \n               message='StochRSI: Exited oversold territory - Consider covering shorts')\n\n// Extreme level alerts\nalertcondition(alertExtremes and extremeOverbought, title='StochRSI Extreme Overbought', \n               message='StochRSI: EXTREME overbought - High reversal probability')\nalertcondition(alertExtremes and extremeOversold, title='StochRSI Extreme Oversold', \n               message='StochRSI: EXTREME oversold - High reversal probability')\n\n// Divergence alerts\nalertcondition(alertDivergence and bullishRegularDiv, title='StochRSI Bullish Divergence', \n               message='StochRSI: Bullish divergence detected - Potential reversal')\nalertcondition(alertDivergence and bearishRegularDiv, title='StochRSI Bearish Divergence', \n               message='StochRSI: Bearish divergence detected - Potential reversal')\n\n// === PERFORMANCE METRICS ===\n// Track signal performance (basic implementation)\nvar int totalBullSignals = 0\nvar int totalBearSignals = 0\nvar int successfulBullSignals = 0\nvar int successfulBearSignals = 0\n\nif filteredBullishEntry\n    totalBullSignals += 1\n    // Check if price went up in next 5 bars (simple success metric)\n    if close[5] > close\n        successfulBullSignals += 1\n\nif filteredBearishEntry\n    totalBearSignals += 1\n    // Check if price went down in next 5 bars\n    if close[5] < close\n        successfulBearSignals += 1\n\n// Success rates (displayed in table if enabled)\nbullSuccessRate = totalBullSignals > 0 ? successfulBullSignals / totalBullSignals * 100 : 0\nbearSuccessRate = totalBearSignals > 0 ? successfulBearSignals / totalBearSignals * 100 : 0",
    "createdAt": 1735200000000,
    "updatedAt": 1735200000000,
    "displayName": "Ultimate Stochastic RSI System",
    "description": "Professional-grade Stochastic RSI with advanced signal generation, divergence detection, multi-timeframe analysis, comprehensive alerts, performance tracking, and integrated overlay signals. Features customizable smoothing, extreme levels, momentum detection, and extensive visualization options.",
    "enabled": true,
    "author": "CustomGPT"
  }
}
